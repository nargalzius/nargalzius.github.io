"use strict";function MapHelper(){}if(MapHelper.prototype={params:{debug:!1,center:null,zoom:15,id:"map",obtrusive:!0,address:"New York, USA",draggable:!0,disableDoubleClickZoom:!0,mapType:"road",minZoom:2,maxZoom:15,chromeless:!0},mapTypes:{road:"ROADMAP",hybrid:"HYBRID",satellite:"SATELLITE",terrain:"TERRAIN"},proxy:null,infoWindow:null,IWparams:{element:null,autopan:!0},delayed:{arg:null,callback:null},api:!1,ready:!1,currentZoom:null,currentCenter:null,clickTo:null,init:function e(t,a){var o=this;if(t&&(this.delayed.arg=t),a&&(this.delayed.callback=a),window.google&&google.maps)if(this.ready)this.trace("Map already initialized");else{switch(this.params.chromeless?this.params.disableDefaultUI=!1:this.params.disableDefaultUI=!0,this.trace(this.get_objecttype(this.delayed.arg)+" detected"),this.get_objecttype(this.delayed.arg)){case"[object String]":this.params.id=this.delayed.arg,document.getElementById(this.params.id);break;case"[object Object]":var i={};for(var n in this.params)i[n]=this.params[n];for(var s in this.delayed.arg)i[s]=this.delayed.arg[s];this.params=i;break;default:this.trace("blank")}this.params.center?(this.params.center=this.get_latlng(this.params.center),this.delayed.callback?this.startmap(this.delayed.callback):this.startmap()):this.params.obtrusive?this.locate_user_gps(function(e){e&&(o.trace("location: "+e),o.params.center=e,o.delayed.callback?o.startmap(o.delayed.callback):o.startmap())}):this.locate_rigged(function(e){o.params.center=e,o.delayed.callback?o.startmap(o.delayed.callback):o.startmap()})}else setTimeout(function(){o.init()},1e3)},startmap:function e(t){this.ready?this.trace("Map already initialized"):(this.evaluate(),this.proxy=new google.maps.Map(document.getElementById(this.params.id),this.params),this.currentZoom=this.proxy.getZoom(),this.currentCenter=this.proxy.getCenter(),this.setListeners(),this.infoWindow=new google.maps.InfoWindow({disableAutoPan:this.IWparams.autopan}),this.ready=!0,t&&t(),this.init_cleanup())},setListeners:function e(){var t=this;this.proxy.addListener("maptypeid_changed",function(e){t.callback_mapTypeChanged()}),this.proxy.addListener("projection_changed",function(e){t.callback_projectionChanged()}),this.proxy.addListener("tilt_changed",function(e){t.callback_tiltChanged()}),this.proxy.addListener("tilesloaded",function(e){t.callback_tilesLoaded()}),this.proxy.addListener("idle",function(e){t.callback_mapIdle()}),this.proxy.addListener("resize",function(e){t.callback_mapResize()}),this.proxy.addListener("mousemove",function(e){t.callback_mapMouseMove()}),this.proxy.addListener("mouseover",function(e){t.callback_mapIn()}),this.proxy.addListener("mouseout",function(e){t.callback_mapOut()}),this.proxy.addListener("rightclick",function(e){t.callback_mapRClick()}),this.proxy.addListener("drag",function(e){t.callback_mapDrag()}),this.proxy.addListener("dragstart",function(e){t.callback_mapDragStart()}),this.proxy.addListener("dragend",function(e){t.callback_mapDragEnd(),t.currentCenter!==t.proxy.getCenter()&&(t.currentCenter=t.proxy.getCenter(),t.callback_centerChanged())}),this.proxy.addListener("click",function(e){t.clickTo=setTimeout(function(){t.callback_mapClick()},300)}),this.proxy.addListener("dblclick",function(e){clearTimeout(t.clickTo),t.callback_mapDClick()}),this.proxy.addListener("zoom_changed",function(e){setTimeout(function(){t.proxy.getZoom()!==t.currentZoom&&(t.trace("Zoom Level: "+t.proxy.getZoom()),t.proxy.getZoom()<t.currentZoom?(t.callback_zoomOut(),t.callback_zoomChanged()):(t.callback_zoomIn(),t.callback_zoomChanged()),t.currentZoom=t.proxy.getZoom())},100)})},callback_mapClick:function e(){this.trace("------------------------- callback_mapClick")},callback_mapDClick:function e(){this.trace("------------------------- callback_mapDClick")},callback_mapRClick:function e(){this.trace("------------------------- callback_mapRClick")},callback_mapDrag:function e(){this.trace("------------------------- callback_mapDrag")},callback_mapDragStart:function e(){this.trace("------------------------- callback_mapDragStart")},callback_mapDragEnd:function e(){this.trace("------------------------- callback_mapDragEnd")},callback_mapMouseMove:function e(){this.trace("------------------------- callback_mapMouseMove")},callback_mapIn:function e(){this.trace("------------------------- callback_mapIn")},callback_mapOut:function e(){this.trace("------------------------- callback_mapOut")},callback_zoomIn:function e(){this.trace("------------------------- callback_zoomIn")},callback_zoomOut:function e(){this.trace("------------------------- callback_zoomOut")},callback_zoomChanged:function e(){this.trace("------------------------- callback_zoomChanged")},callback_centerChanged:function e(){this.trace("------------------------- callback_centerChanged")},callback_projectionChanged:function e(){this.trace("------------------------- callback_projectionChanged")},callback_mapTypeChanged:function e(){this.trace("------------------------- callback_mapTypeChanged")},callback_tiltChanged:function e(){this.trace("------------------------- callback_tiltChanged")},callback_tilesLoaded:function e(){this.trace("------------------------- callback_tilesLoaded")},callback_mapIdle:function e(){this.trace("------------------------- callback_mapIdle")},callback_mapResize:function e(){this.trace("------------------------- callback_mapResize")},evaluate:function e(){this.set_maptype(this.params.mapType,!0),this.params.disableDefaultUI=this.params.chromeless},set_maptype:function e(t,a){if(window.google&&google.maps)if("road"===t||"terrain"===t||"satellite"===t||"hybrid"===t){this.trace("Changing map type to: "+t);var o=google.maps.MapTypeId[this.mapTypes[t]];this.proxy&&this.proxy.setMapTypeId(o),a&&(this.params.mapTypeId=o,this.params.mapType=t)}else this.params.mapType?this.trace('Invalid Map Type, choose from: "road", "hybrid", "satellite", and "terrain"'):this.trace("Using default map type (road)")},get_staticmap:function e(t,a,o){var i=void 0;i=o||this.params.zoom;var n=document.getElementById(t).offsetHeight;return"https://maps.googleapis.com/maps/api/staticmap?center="+a+"&zoom="+i+"&size="+document.getElementById(t).offsetWidth+"x"+n},resize:function e(){var t=this;google.maps.event.trigger(this.proxy,"resize")},zoom:function e(t){this.ready&&this.proxy.setZoom(t)},center:function e(t,a,o){if(this.ready){var i=void 0;if(i=t?this.get_latlng(t):this.params.center,t&&a)switch(this.get_objecttype(a)){case"[object Object]":a.replace&&(this.params.center=i);var n=0,s=0;a.x&&(n=a.x),a.y&&(s=-1*a.y);var r=Math.pow(2,this.proxy.getZoom()),c=new google.maps.LatLng(this.proxy.getBounds().getNorthEast().lat(),this.proxy.getBounds().getSouthWest().lng()),l=this.proxy.getProjection().fromLatLngToPoint(i),d=new google.maps.Point(n/r||0,s/r||0),h=new google.maps.Point(l.x-d.x,l.y+d.y);i=this.proxy.getProjection().fromPointToLatLng(h);break;default:this.params.center=i}o?this.proxy.setCenter(i):this.proxy.panTo(i)}},locate_user_gps:function e(t,a){var o=this;if(t&&window.google&&google.maps){var i=void 0,n=function e(n){o.trace("location accuracy: "+n.coords.accuracy),i=o.get_latlng([n.coords.latitude,n.coords.longitude]),a&&o.proxy.setCenter(i),t?t(i):o.trace(i)},s=function e(a){o.trace("error or location not found: "+a),i=a,o.locate_rigged(t)};navigator.geolocation.getCurrentPosition(n,s)}},locate_find:function e(t,a){var o=this;if(window.google&&google.maps){this.trace("finding: "+t);(new google.maps.Geocoder).geocode({address:t},function(e,i){i===google.maps.GeocoderStatus.OK?(o.trace("coordinates for "+t+" is: "+e[0].geometry.location),a(e[0].geometry.location)):(o.trace("Geocode was not successful for the following reason: "+i),a(null))})}},locate_resolve:function e(t,a){var o=this;if(window.google&&google.maps){this.trace("resolve: "+t);(new google.maps.Geocoder).geocode({latLng:this.get_latlng(t)},function(e,t){t===google.maps.GeocoderStatus.OK?e?(o.trace("success"),a(e)):(o.trace("no results"),a(null)):(o.trace("reverse geocoding failed due to: "+t),a(null))})}},locate_rigged:function e(t){window.google&&google.maps&&this.locate_find(this.params.address,function(e){t&&t(e)})},infowindow_show:function e(t,a){if(t.info){var o=document.createElement("div");if(o.className="infoWindow",a)o.appendChild(a);else{var i=void 0;"[object String]"===this.get_objecttype(t.info)?(i=document.createElement("div"),i.className="info default text",i.innerHTML=t.info):i="[object Function]"===this.get_objecttype(t.info)?t.info():t.info,o.appendChild(i)}this.infoWindow.setContent(o),this.infoWindow.open(this.proxy,t),this.trace("showing infoWindow for marker "+t.id)}},infowindow_hide:function e(){this.infoWindow.setContent(""),this.infoWindow.close(),this.trace("hiding infoWindow")},marker_log:{index:0,markers:[],locations:[]},marker_add:function e(t){if(this.ready){var a=this.get_latlng(t.loc),o=new google.maps.Marker({id:null,map:this.proxy,position:a,events:null,info:null,loc:a});t.icon&&o.setIcon(t.icon),t.info&&(o.info=t.info),t.events&&(o.events=t.events),o.id=this.marker_log.index,this.marker_log.locations||(this.marker_log.locations=[]),this.marker_log.locations.push(o.position),this.marker_log.markers.push(o),this.marker_log.index++,o.setMap(this.proxy),this.listeners_add(o),this.trace(o)}},markers_fit:function e(t){if(this.ready){var a=new google.maps.LatLngBounds;0===this.marker_log.locations.length&&this.marker_log.locations.push(this.params.center),this.marker_log.locations.forEach(function(e){a.extend(e)}),this.proxy.setCenter(a.getCenter()),t?this.proxy.panToBounds(a):this.proxy.fitBounds(a)}},markers_show:function e(){this.ready&&this.markers_set(this.proxy)},markers_hide:function e(){this.ready&&this.markers_set(null)},markers_clear:function e(){for(var t=0;t<this.marker_log.markers.length;t++){var a=this.marker_log.markers[t];this.listeners_remove(a)}this.markers_set(null),this.marker_log.arrayid=0,this.marker_log.markers=[],this.marker_log.locations=[]},markers_set:function e(t){this.ready&&this.marker_log.markers.length&&this.marker_log.markers.forEach(function(e){e.setMap(t)})},listeners_add:function e(t){var a=this;google.maps.event.addListener(t,"click",function(){this.events&&this.events.click?this.events.click(this):a.trace("clicked on marker: "+this.id)}),google.maps.event.addListener(t,"dblclick",function(){this.events&&this.events.dclick&&this.events.dclick(this)}),google.maps.event.addListener(t,"mouseover",function(){this.events&&this.events.over&&this.events.over(this)}),google.maps.event.addListener(t,"mouseout",function(){this.events&&this.events.out&&this.events.out(this)})},listeners_remove:function e(t){google.maps.event.clearListeners(t,"click"),google.maps.event.clearListeners(t,"dblclick"),google.maps.event.clearListeners(t,"mouseover"),google.maps.event.clearListeners(t,"mouseout")},get_distance:function e(t,a,o){if(window.google&&google.maps){var i=function e(t){return t*Math.PI/180},n=this.get_latlng(t),s=this.get_latlng(a),r=6371e3,c=i(s.lat()-n.lat()),l=i(s.lng()-n.lng()),d=Math.sin(c/2)*Math.sin(c/2)+Math.cos(i(n.lat()))*Math.cos(i(s.lat()))*Math.sin(l/2)*Math.sin(l/2),h=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),p=r*h;p=.01*Math.round(p*621371e-9*100);var g=Number(p.toFixed(1));if(!o)return g;o(g)}},get_latlng:function e(t,a){if(window.google&&google.maps){var o=void 0;switch(this.get_objecttype(t)){case"[object String]":o=new google.maps.LatLng(t.split(",")[0],t.split(",")[1]);break;case"[object Array]":o=new google.maps.LatLng(t[0],t[1]);break;case"[object Object]":if(t.lon){t={lat:t.lat,lng:t.lon}}o=t;break}if(!a)return o;a(o)}},trace:function e(t){window.console&&this.params.debug&&console.log(t)},get_objecttype:function e(t){return Object.prototype.toString.call(t)},init_cleanup:function e(){this.delayed.callback=null,this.delayed.arg=null},destroy:function e(){this.ready?(this.markers_clear(),google.maps.event.clearListeners(this.proxy,"zoom_changed"),this.infoWindow=null,this.proxy=null,document.getElementById(this.params.id).innerHTML="",this.ready=!1):this.trace("nothing to destroy")}},!window.google||!google.maps){var checkDebug=!!(window.console&&window.debug&&debug);checkDebug&&console.log("LOADING MAP API");var tag=document.createElement("script");tag.src="https://maps.googleapis.com/maps/api/js?v=3.exp&callback=GMapAPIinit",window.GMapAPIKey&&(tag.src+="&key="+window.GMapAPIKey);var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var GMapAPIinit=function e(){void 0!==window.EventBus&&EventBus.dispatch("MAP_LOADED",window),checkDebug&&console.log("GoogleMaps API loaded")}}