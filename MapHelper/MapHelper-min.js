"use strict";function MapHelper(){}if(MapHelper.prototype={params:{debug:!1,center:null,zoom:15,id:"map",obtrusive:!0,address:"New York, USA",draggable:!0,disableDoubleClickZoom:!0,mapType:"road",minZoom:2,maxZoom:15,chromeless:!0},mapTypes:{road:"ROADMAP",hybrid:"HYBRID",satellite:"SATELLITE",terrain:"TERRAIN"},proxy:null,infoWindow:null,IWparams:{element:null,autopan:!0},delayed:{arg:null,callback:null},api:!1,ready:!1,init:function e(t,a){var o=this;if(t&&(this.delayed.arg=t),a&&(this.delayed.callback=a),window.google&&google.maps)if(this.ready)this.trace("Map already initialized");else{switch(this.params.chromeless?this.params.disableDefaultUI=!1:this.params.disableDefaultUI=!0,this.trace(this.get_objecttype(this.delayed.arg)+" detected"),this.get_objecttype(this.delayed.arg)){case"[object String]":this.params.id=this.delayed.arg,document.getElementById(this.params.id);break;case"[object Object]":var i={};for(var s in this.params)i[s]=this.params[s];for(var n in this.delayed.arg)i[n]=this.delayed.arg[n];this.params=i;break;default:this.trace("blank")}this.params.center?(this.params.center=this.get_latlng(this.params.center),this.delayed.callback?this.startmap(this.delayed.callback):this.startmap()):this.params.obtrusive?this.locate_user_gps(function(e){e&&(o.trace("location: "+e),o.params.center=e,o.delayed.callback?o.startmap(o.delayed.callback):o.startmap())}):this.locate_rigged(function(e){o.params.center=e,o.delayed.callback?o.startmap(o.delayed.callback):o.startmap()})}else setTimeout(function(){o.init()},1e3)},startmap:function e(t){var a=this;this.ready?this.trace("Map already initialized"):(this.evaluate(),this.proxy=new google.maps.Map(document.getElementById(this.params.id),this.params),this.proxy.addListener("zoom_changed",function(){a.trace("Zoom Level: "+a.proxy.getZoom())}),this.infoWindow=new google.maps.InfoWindow({disableAutoPan:this.IWparams.autopan}),this.ready=!0,t&&t(),this.init_cleanup())},evaluate:function e(){this.set_maptype(this.params.mapType,!0),this.params.disableDefaultUI=this.params.chromeless},set_maptype:function e(t,a){if(window.google&&google.maps)if("road"===t||"terrain"===t||"satellite"===t||"hybrid"===t){this.trace("Changing map type to: "+t);var o=google.maps.MapTypeId[this.mapTypes[t]];this.proxy&&this.proxy.setMapTypeId(o),a&&(this.params.mapTypeId=o,this.params.mapType=t)}else this.params.mapType?this.trace('Invalid Map Type, choose from: "road", "hybrid", "satellite", and "terrain"'):this.trace("Using default map type (road)")},get_staticmap:function e(t,a,o){var i=void 0;i=o||this.params.zoom;var s=document.getElementById(t).offsetHeight;return"https://maps.googleapis.com/maps/api/staticmap?center="+a+"&zoom="+i+"&size="+document.getElementById(t).offsetWidth+"x"+s},resize:function e(){var t=this;google.maps.event.trigger(this.proxy,"resize")},zoom:function e(t){this.ready&&this.proxy.setZoom(t)},center:function e(t,a,o){if(this.ready){var i=void 0;if(i=t?this.get_latlng(t):this.params.center,t&&a)switch(this.get_objecttype(a)){case"[object Object]":a.replace&&(this.params.center=i);var s=0,n=0;a.x&&(s=a.x),a.y&&(n=-1*a.y);var r=Math.pow(2,this.proxy.getZoom()),l=new google.maps.LatLng(this.proxy.getBounds().getNorthEast().lat(),this.proxy.getBounds().getSouthWest().lng()),c=this.proxy.getProjection().fromLatLngToPoint(i),g=new google.maps.Point(s/r||0,n/r||0),d=new google.maps.Point(c.x-g.x,c.y+g.y);i=this.proxy.getProjection().fromPointToLatLng(d);break;default:this.params.center=i}o?this.proxy.setCenter(i):this.proxy.panTo(i)}},locate_user_gps:function e(t,a){var o=this;if(t&&window.google&&google.maps){var i=void 0,s=function e(s){o.trace("location accuracy: "+s.coords.accuracy),i=o.get_latlng([s.coords.latitude,s.coords.longitude]),a&&o.proxy.setCenter(i),t?t(i):o.trace(i)},n=function e(a){o.trace("error or location not found: "+a),i=a,o.locate_rigged(t)};navigator.geolocation.getCurrentPosition(s,n)}},locate_find:function e(t,a){var o=this;if(window.google&&google.maps){this.trace("finding: "+t);(new google.maps.Geocoder).geocode({address:t},function(e,i){i===google.maps.GeocoderStatus.OK?(o.trace("coordinates for "+t+" is: "+e[0].geometry.location),a(e[0].geometry.location)):(o.trace("Geocode was not successful for the following reason: "+i),a(null))})}},locate_resolve:function e(t,a){var o=this;if(window.google&&google.maps){this.trace("resolve: "+t);(new google.maps.Geocoder).geocode({latLng:this.get_latlng(t)},function(e,t){t===google.maps.GeocoderStatus.OK?e?(o.trace("success"),a(e)):(o.trace("no results"),a(null)):(o.trace("reverse geocoding failed due to: "+t),a(null))})}},locate_rigged:function e(t){window.google&&google.maps&&this.locate_find(this.params.address,function(e){t&&t(e)})},infowindow_show:function e(t,a){if(t.info){var o=document.createElement("div");if(o.className="infoWindow",a)o.appendChild(a);else{var i=void 0;"[object String]"===this.get_objecttype(t.info)?(i=document.createElement("div"),i.className="info default text",i.innerHTML=t.info):i="[object Function]"===this.get_objecttype(t.info)?t.info():t.info,o.appendChild(i)}this.infoWindow.setContent(o),this.infoWindow.open(this.proxy,t),this.trace("showing infoWindow for marker "+t.id)}},infowindow_hide:function e(){this.infoWindow.setContent(""),this.infoWindow.close(),this.trace("hiding infoWindow")},marker_log:{index:0,markers:[],locations:[]},marker_add:function e(t){if(this.ready){var a=this.get_latlng(t.loc),o=new google.maps.Marker({id:null,map:this.proxy,position:a,events:null,info:null,loc:a});t.icon&&o.setIcon(t.icon),t.info&&(o.info=t.info),t.events&&(o.events=t.events),o.id=this.marker_log.index,this.marker_log.locations||(this.marker_log.locations=[]),this.marker_log.locations.push(o.position),this.marker_log.markers.push(o),this.marker_log.index++,o.setMap(this.proxy),this.listeners_add(o),this.trace(o)}},markers_fit:function e(t){if(this.ready){var a=new google.maps.LatLngBounds;0===this.marker_log.locations.length&&this.marker_log.locations.push(this.params.center),this.marker_log.locations.forEach(function(e){a.extend(e)}),this.proxy.setCenter(a.getCenter()),t?this.proxy.panToBounds(a):this.proxy.fitBounds(a)}},markers_show:function e(){this.ready&&this.markers_set(this.proxy)},markers_hide:function e(){this.ready&&this.markers_set(null)},markers_clear:function e(){for(var t=0;t<this.marker_log.markers.length;t++){var a=this.marker_log.markers[t];this.listeners_remove(a)}this.markers_set(null),this.marker_log.arrayid=0,this.marker_log.markers=[],this.marker_log.locations=[]},markers_set:function e(t){this.ready&&this.marker_log.markers.length&&this.marker_log.markers.forEach(function(e){e.setMap(t)})},listeners_add:function e(t){var a=this;google.maps.event.addListener(t,"click",function(){this.events&&this.events.click?this.events.click(this):a.trace("clicked on marker: "+this.id)}),google.maps.event.addListener(t,"dblclick",function(){this.events&&this.events.dclick&&this.events.dclick(this)}),google.maps.event.addListener(t,"mouseover",function(){this.events&&this.events.over&&this.events.over(this)}),google.maps.event.addListener(t,"mouseout",function(){this.events&&this.events.out&&this.events.out(this)})},listeners_remove:function e(t){google.maps.event.clearListeners(t,"click"),google.maps.event.clearListeners(t,"dblclick"),google.maps.event.clearListeners(t,"mouseover"),google.maps.event.clearListeners(t,"mouseout")},get_distance:function e(t,a,o){if(window.google&&google.maps){var i=function e(t){return t*Math.PI/180},s=this.get_latlng(t),n=this.get_latlng(a),r=6371e3,l=i(n.lat()-s.lat()),c=i(n.lng()-s.lng()),g=Math.sin(l/2)*Math.sin(l/2)+Math.cos(i(s.lat()))*Math.cos(i(n.lat()))*Math.sin(c/2)*Math.sin(c/2),d=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),h=r*d;h=.01*Math.round(h*621371e-9*100);var p=Number(h.toFixed(1));if(!o)return p;o(p)}},get_latlng:function e(t,a){if(window.google&&google.maps){var o=void 0;switch(this.get_objecttype(t)){case"[object String]":o=new google.maps.LatLng(t.split(",")[0],t.split(",")[1]);break;case"[object Array]":o=new google.maps.LatLng(t[0],t[1]);break;case"[object Object]":if(t.lon){t={lat:t.lat,lng:t.lon}}o=t;break}if(!a)return o;a(o)}},trace:function e(t){window.console&&this.params.debug&&console.log(t)},get_objecttype:function e(t){return Object.prototype.toString.call(t)},init_cleanup:function e(){this.delayed.callback=null,this.delayed.arg=null},destroy:function e(){this.ready?(this.markers_clear(),google.maps.event.clearListeners(this.proxy,"zoom_changed"),this.infoWindow=null,this.proxy=null,document.getElementById(this.params.id).innerHTML="",this.ready=!1):this.trace("nothing to destroy")}},!window.google||!google.maps){var checkDebug=!!(window.console&&window.debug&&debug);checkDebug&&console.log("LOADING MAP API");var tag=document.createElement("script");tag.src="https://maps.googleapis.com/maps/api/js?v=3.exp&callback=GMapAPIinit",window.GMapAPIKey&&(tag.src+="&key="+window.GMapAPIKey);var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var GMapAPIinit=function e(){void 0!==window.EventBus&&EventBus.dispatch("MAP_LOADED",window),checkDebug&&console.log("GoogleMaps API loaded")}}