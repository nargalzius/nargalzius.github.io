<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Joystick Studio v2 Expandable </title>
    <link rel="stylesheet" type="text/css" href="../../../../../../f/c/readme.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
  </head>
  <body>
    <header id="info"><img id="logo" src="../../../../../../img/joystick/logo.png" alt="Joystick Interactive">
      <h1>Joystick Studio v2 Expandable</h1><p>The purpose of this set of AS3 Class files is to standardize the implementation of core functionality of Studio expandables used by the organization and accomodate typical behavior required for most implementations.</p>

<p>As an example, take a look at the various implementations of ads in <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w">this [test] demo campaign</a>. All the files have the same document classes under the hood, and have minimal code and elements to accomplish the animations, maskings, borders, etc.</p>

<p>Another goal of such an approach is that since majority the core expandable functionality has been abstracted outside of the Flash files, it is possible to create similar document classes for non-Studio expandables in such a way that porting regular demos to Studio implementations can be achieved mostly by just switching the document classes. </p>

<p>This unfortuantely doesn&#39;t cover the video components - so you&#39;ll still have to convert those manually. But who knows...</p>
      <h3>Resources</h3>
      <ul>
        <li><a href="#usage">Getting Started</a></li>
        <li><a href="#api">Full Documentation  </a></li>
        <li><a target="_blank" href="http://nargalzius.github.io/flash/joystick/as3/studio/v2/expanding/sample.zip">Download</a> (.zip)</li>
        <li><a href="#changelog">Changelog</a></li>
      </ul><h3>Requirements/Dependencies</h3>

<ul><li>Flash Player 9 or higher</li><li>ActionScript 3</li><li><a href="https://support.google.com/richmedia/answer/2389098?hl=en">DoubleClick Studio Component v2 (AS3)</a></li><li><a href="http://www.greensock.com">GreenSock Animation Platform (AS3)</a></li></ul>
    </header>
    <section id="usage">
      <h1>Quick Start</h1><p>So let&#39;s say we want to make a <code>300x250</code> unit that expands to <code>500x250</code> to the <em>left.</em> We&#39;ll use the [typical] 3-file approach: One file as <code>parent.swf</code> with a canvas size of 500x250, the other as <code>collapsed.swf</code> with a canvas size of 300x250, and lastly, one called <code>expanded.swf</code> with 500x250 as its canvas size.</p>

<h3>Parent SWF</h3>

<p>For <code>parent.swf</code>, we only need to have <strong>two</strong> components on the stage; the <code>Studio enabler</code>, and the <code>expanding component</code> - both of which are included in the DoubleClick Studio Extension set. That&#39;s it, nothing more - the rest we&#39;ll do programatically ;)</p>

<p>Set the <code>expanding component</code> to the size of your collapsed state (300x250) and position it where you wish it to be placed relative to its expanded state. Do not set anything on the component via the inspector. Merely resize it and position it.</p>

<p>Now set <code>parent.swf&#39;s</code> <strong>document class</strong> to <code>com.joystick.studio.v2.Expand</code>. What you just did was include a base class that automatically calculates and generates the masks, movieclips, animations, event handlers, etc. that for core expanding functionality. </p>

<p>Only thing left to do is initialize it manually <em>after</em> we set some parameters via ActionScript. Put this AS3 code in the first frame of your actions layer.</p>
      <div class="fullCode">
        <pre class="syntax html">/* SET PARAMETERS */
_COLLAPSED = &quot;FILENAME.swf&quot;;
_EXPANDED = &quot;FILENAME.swf&quot;;
//_DURATION = 1;
//_AUTOEXPAND = true;
//_AUTOCOLLAPSE = 8;
//_ACCOI = false;
//_MOUSECOLLAPSE = true;
//_PUSHDOWN = true;
//_DIRECTION = &quot;L&quot;;
//_BORDER = NaN;
//debug = true;

/* INITIALIZE STUDIO */
init();
</pre>
      </div><p>The full details on the variables listed above are discussed in the <a href="#api">API section</a>. But for our purposes, All you need to uncomment is the <code>_DIRECTION</code> variable - which is conveniently set to <code>L</code>. </p>

<p>You can see that at the end of it all, the initialization call <code>init()</code> is made. Your <code>parent.swf</code> is now ready. Let&#39;s move on and setup the children.</p>

<h3>Collapsed SWF</h3>

<p>For the <code>collapsed.swf</code> we need two <code>displayObject</code>s on the stage: one for your <strong>background exit</strong> button, and another for your <strong>expand</strong> trigger. Give them both instance names.</p>

<p>Set the document class of your collapsed swf to <code>com.joystick.studio.v2.CollapsedChild</code></p>

<p>The only thing to remember is that you must use a <code>MovieClip</code> for your <strong>exit</strong> button - as for some reason, the document class it fails to assign the trigger if it&#39;s a button. Shouldn&#39;t be an issue though.</p>

<p>Now paste this code on the actions layer</p>
      <div class="fullCode">
        <pre class="syntax actionscript">function metaHandler(e:Event):void
{
 switch(e.type)
 {
  case &quot;META_TRIGGERED&quot;: 
   /* USER ACTIONS WHEN EXPAND/COLLAPSE IS TRIGGERED */
  break;
  case &quot;META_EXPANDING&quot;: 
   /* USER ACTIONS WHEN EXPAND ANIMATION STARTS */
  break;
  case &quot;META_EXPANDED&quot;: 
   /* USER ACTIONS WHEN EXPAND ANIMATION FINSIHES */
  break;
  case &quot;META_COLLAPSING&quot;: 
   /* USER ACTIONS WHEN COLLAPSE ANIMATION STARTS */
  break;
  case &quot;META_COLLAPSED&quot;: 
   /* USER ACTIONS WHEN COLLAPSE ANIMATION FINISHES */
  break;
 }
}

_EXIT = INSTANCE;
_TRIGGER = INSTANCE;
//_DELAY = 0;
//_ROLLOVER = true;
//debug = true;

init();
</pre>
      </div><p>I&#39;ll discuss the metaHandler later, but for now, focus on the four variables above the <code>init()</code> call. You basically assign the two displayObjects accordingly - then the document class will automatically generate the appropriate listeners and calls for expand and exit, make the exit button transparent and resize it to fill the entire stage.</p>

<h3>Expanded SWF</h3>

<p>For the expanded file, simply duplicate the collapsed file and resize the stage to the expanded dimensions (500x250). Also, change its document class to <code>com.joystick.studio.v2.ExpandedChild</code>. </p>

<p>What you just did was <em>automatically</em> switch the behavior of the [expand] trigger to <strong>collapse</strong> the ad, and the exit button to report a background exit from the expanded state. All you really need to do at this point is simply change the text on your &quot;trigger button&quot; (which I imagene would be something like &quot;click to expand&quot;) to better represent a <strong>close/collapse</strong> action.</p>

<p>Congratulations. You now have a basic working expanding ad. Of course I need not remind you that Studio-related events will not fire unless you&#39;re running everything from the main parent (with the main Enabler).</p>

<h3>Anatomy of the Expanding Class(es)</h3>

<p>The template does so much more behind the scenes - hopefully the API would help in explaning it better. But for those who are curious as to what &quot;process&quot; this system follows for buildilng core functionality, here&#39;s a how a typical implementation of the ad would work.</p>

<h4>On initial load.</h4>

<ol><li>Parent swf is loaded (let&#39;s call it <code>Parent</code>), </li><li>Container movieclips are created (to be populated by StudioLoader)</li><li>Masks, and transition animations are determined and set depending on the user-settings.</li><li>Collapsed swf is loaded (let&#39;s call it <code>Collapsed</code>) via Polite Load (done programatically, so the PoliteLoad component icon will not appear in Studio webpage&#39;s &quot;component&quot; tab)</li></ol>

<h4>On user expand</h4>

<ol><li><code>Collapsed</code> notifies <code>Parent</code> to load expanded swf (let&#39;s call it <code>Expanded</code>).</li><li><code>Parent</code> starts loading <code>Expanded</code> but <strong>does not</strong> expand yet. This is to ensure that the expansion animation is only started when <code>Expanded</code> is fully ready to be displayed.</li><li>When <code>Expanded</code> is fully ready, <code>Parent</code> requests for confirmation from <code>Collapsed</code> to proceed expanding... The reason it doesn&#39;t do it automatically is to accomodate <code>Collapsed</code>&#39;s <code>_DELAY</code> variable (read the API for more).<br/><code>META_TRIGGERED</code> is also fired on <code>Collapsed</code> at this point.</li><li><code>Child</code> receives <code>Parent</code>&#39;s request, and starts a timer to make the final expand call (i.e. an &quot;all green&quot; signal) based on its <code>_DELAY</code> variable.<br/>By default, <code>_DELAY</code> is set to zero - so that means as soon as <code>Expanded</code> is ready, <code>Collapsed</code> will instantaneously give <code>Parent</code> the &quot;all-green&quot; to perform the expand transition.</li><li><code>Parent</code> receives final expand call from <code>Collapsed</code> and performs expansion animation based on <code>Parent</code>&#39;s <code>_DURATION</code> variable. Both <code>Collapsed</code> and <code>Collapsed</code> are &quot;disabled&quot; to prevent extraneous input that can mess with the wole procedure.<br/><code>META_EXPANDING</code> is also fired to <em>both</em> <code>Collapsed</code> <em>and</em> <code>Expanded</code> at this point. </li><li>When expansion animation is done, <code>META_EXPANDED</code> is fired to <em>both</em> <code>Collapsed</code> and <code>Expanded</code></li></ol>

<h4>On user close, exit event, or mousecollapse (if applicable)</h4>

<ol><li>Like with <code>Collapsed</code>&#39;s expansion delay, <code>Expanded</code> starts a timer to make the final collapse call based on its <code>_DELAY</code> variable.<br/><code>META_TRIGGERED</code> is fired at this point.</li><li>When the timer is done, (immediately by default), it tells <code>Parent</code> to start collapse animation.</li><li><code>Parent</code> receives instruction and starts collapse animation.  Both <code>Collapsed</code> and <code>Collapsed</code> are &quot;disabled&quot;.<br/><code>META_COLLAPSING</code> is fired on both.</li><li>When collapse animation is done, <code>Expanded</code> is unloaded, and <code>META_COLLAPSED</code> if fired on <code>Collapsed</code></li></ol>
    </section>
    <section id="api">
      <h1>API</h1>
      <h2>Parent SWF</h2><p>Document class file:<br/><code>com.joystick.studio.v2.Expand</code> (extends Enabler)</p>
      <ul>
        <li><strong><code class="property">debug  </code></strong><code class="property">: Boolean = </code><em> <code class="property">false</code></em><p>Toggle trace of various actions for debugging</p>

<p>Also, if you want to disable the &quot;clutter&quot; that the <a href="http://www.google.com/doubleclick/studio/docs/sdk/flash/as3/en/com_google_ads_studio_utils_Logger.html">Studio Logger</a> generates, you can use this:</p>
          <div class="quickCode">
            <pre class="syntax actionscript">import com.google.ads.studio.utils.Logger;
Logger.setLogLevel(Logger.NONE);
</pre>
          </div>
        </li>
        <li><strong><code class="property">_COLLAPSED </code></strong><code class="property">: String</code><p>Filname of collapsed file.</p>

<p>The parent swf automatically generates a container, which the collapsed file is loaded into. Furthermore, it creates a mask (for the sake of neatness) for the child based on the dimensions of the <code>expanding</code> component (which you manually set) - it then positions the child (and it&#39;s mask) on the same location of the expanding component.</p>

<p>This is the reason why it&#39;s not necessary to &quot;set&quot; the expanding component to load any file via its component inspector.</p>
        </li>
        <li><strong><code class="property">_EXPANDED </code></strong><code class="property">: String</code><p>Filname of expanded file.</p>

<p>Like with the collapsed swf, the parent generates the appropriate container in which to load the file onto. It also generates the appropriate mask.</p>

<p>When an expand is triggered, the expand animation only starts when the expanded has been fully loaded. Likewise, it is fully unloaded when a collapse completes.</p>
        </li>
        <li><strong><code class="property">_DURATION </code></strong><code class="property">: Number = </code><em><code class="property">1</code></em><p>The default expansion animation time. You may set it faster for normal expands, but it&#39;s advisable to keep it at <code>1</code> second or longer for _PUSHDOWNs.</p>

<p>set it to <code>0</code> if you want an immediate expand (popup). <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24665846">Example</a></p>
        </li>
        <li><strong><code class="property">_AUTOEXPAND </code></strong><code class="property">: Boolean = </code><em><code class="property">false</code></em><p>Self-explanatory. When enabled, the collapsed state will be invisible on initial load. This is to make sure that the first thing the user sees is the expanded animation/state. <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24666758">Example</a></p>
        </li>
        <li><strong><code class="property">_AUTOCOLLAPSE </code></strong><code class="property">: Number = </code><em><code class="property">0</code></em><p>The number of seconds before an auto-collapse is executed. When set to 0, it&#39;s disabled. <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24666758">Example</a></p>
        </li>
        <li><strong><code class="property">_ACCOI </code></strong><code class="property">: Boolean = </code><em><code class="property">true</code></em><p>Short for <strong>A</strong>uto <strong>C</strong>ollapse <strong>C</strong>ancel <strong>O</strong>n <strong>I</strong>nteraction. This listens for the <code>StudioEvent.INTERACTION</code> event, which is Studio&#39;s own way of telling if a user has interacted with a unit. <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24666763">Example</a></p>

<p>Because it&#39;s not really clear how Studio &quot;determines&quot; what constitutes an &quot;interaction&quot;, you may opt to bypass it entirely (i.e. if you want it cancelled by different rules) by setting it to <code>false</code></p>

<p>The cancellation can be manually called through the following event: </p>
          <div class="quickCode">
            <pre class="syntax actionscript">parent.dispatchEvent(new Event(&quot;KILL_AUTOCOLLAPSE&quot;));</pre>
          </div>
        </li>
        <li><strong><code class="property">_MOUSECOLLAPSE </code></strong><code class="property">: Boolean = </code><em><code class="property">false</code></em><p>Collapse on mouseout. If the user navigates away from the unit, it will collapse. <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24666755">Example</a></p>
        </li>
        <li><strong><code class="property">_PUSHDOWN </code></strong><code class="property">: Boolean = </code><em><code class="property">false</code></em><p>Set triggers for Pushdown functionality. Both regular expandables and pushdowns call <code>expanding.expand()</code> at the same time. But they call <code>expanding.collapse()</code> at different times.</p>

<p>Regular animated expands have to make the call when the collapse animation is done, whereas the _PUSHDOWNs call it at the same time the collapse animation starts.</p>

<p>Pushdowns also have no easing in their expansion animations - to match the lack of easing on the HTML animations. <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24666758">Example</a></p>
        </li>
        <li><strong><code class="property">_DIRECTION  </code></strong><code class="property">: string = </code><em> <code class="property">'D'</code></em><p>Direction of the expand. Mask transitions/animations are done automatically. Accepts the following values (case sensitive):</p>
          <ul>
            <li> <code class="property">D </code>(Down, default) expands downward from top</li>
            <li> <code class="property">U </code>(Up) expands upward from bottom</li>
            <li> <code class="property">L </code>(Left) expands left from right</li>
            <li> <code class="property">R </code>(Right) expands right from left</li>
            <li> <code class="property">LU </code>(Left/Up) expands diagonally to top-left from bottom-right <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24665841">Example</a></li>
            <li> <code class="property">LD </code>(Left/Down) expands diagonally to bottom-left from top-right</li>
            <li> <code class="property">RU </code>(Right/Up) expands diagonally to top-right from bottom-left</li>
            <li> <code class="property">RD </code>(Right/Down) expands diagonally to bottom-right from top-left</li>
            <li> <code class="property">O </code>(Omni) expands outward to all directions from center of collapsed child <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24666763">Example</a></li>
          </ul>
        </li>
        <li><strong><code class="property">_BORDER </code></strong><code class="property">: Number = </code><em><code class="property">0x000000</code></em><p>Automatically generates a stroke/border around the expanded/collapsed MCs as they are loaded to the stage.</p>

<p>Accepts numbers in &quot;hex color value format&quot; that Flash understands natively (i.e. pre-pended by <code>0x</code>). It defaults to black (<code>0x000000</code>).</p>

<p>Most of the time, borders are required, so I thought it would be good to just include this as default behavior. If you wish to disable the borders for some cases, you can set <code>_BORDER</code> to a non-finite number such as <code>-1</code> or <code>NaN</code>.</p>
        </li>
      </ul>
      <h2>Children SWFs</h2><p>Document class file(s):<br/><code>com.joystick.studio.v2.CollapsedChild</code> (extends ExpandProxy)<br/><code>com.joystick.studio.v2.ExpandedChild</code> (extends ExpandProxy)</p>
      <ul>
        <li><strong><code class="property">debug  </code></strong><code class="property">: Boolean = </code><em> <code class="property">false</code></em><p>Toggle trace of various actions for debugging</p>
        </li>
        <li><strong><code class="property">_TRIGGER </code></strong><code class="property">: Button / MovieClip</code><p>Trigger button. Whether it triggers an expand or collapse depends on what document class your file is using.</p>
        </li>
        <li><strong><code class="property">_EXIT </code></strong><code class="property">: MovieClip</code><p>Studio fails to register the exit event if this is set to a button. But it&#39;s basically your background exit button.</p>
        </li>
        <li><strong><code class="property">_DELAY </code></strong><code class="property">: Boolean = </code><em><code class="property">false</code></em><p>A delay before the expand or collapse is called. Useful to for having pre-expand/collapse animations. <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24677336">Example</a></p>
        </li>
        <li><strong><code class="property">_ROLLOVER </code></strong><code class="property">: Boolean = </code><em><code class="property">false</code></em><p>Assigns your trigger to be fired on rollover. <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24666755">Example</a></p>

<p>If you feel that you want to override (or augment) the functionality of the unit, you can always manually trigger expands/collapses in the timeline by using <code>expand()</code> or <code>collapse()</code>.</p>
        </li>
      </ul><h3>The <code>metaHandler()</code> function</h3>

<p>From the code snippet above, these are the events that the metaHandler intercepts.</p>
      <ul>
        <li><strong><code class="property">META_TRIGGERED </code></strong><code class="property">: Event</code><p>Fired when a collapse/expand is triggered.</p>

<p>It&#39;s worth remembering that this isn&#39;t necessarily an &quot;immediate trigger&quot; - triggers from either state (collapsed/expanded) will both respect whatever <code>_DELAY</code> setting you have.</p>

<p>However, in the case of the collapsed state trying to expand, it will only &quot;trigger&quot; once it has confirmed with the parent that the expanded swf is ready to be displayed.</p>
        </li>
        <li><strong><code class="property">META_EXPANDING </code></strong><code class="property">: Event</code><p>Fired when the expanding animation starts.</p>
        </li>
        <li><strong><code class="property">META_EXPANDED</code></strong><code class="property">: Event</code><p>Triggered when expand has completed.</p>
        </li>
        <li><strong><code class="property">META_COLLAPSING</code></strong><code class="property">: Event</code><p>Triggered when collapse starts.</p>
        </li>
        <li><strong><code class="property">META_COLLAPSED</code></strong><code class="property">: Event</code><p>Triggered when collapse has completed.</p>
        </li>
      </ul><h4>Practical Example of metaHandler event use</h4>

<p>Take a look at <a href="http://www.google.com/doubleclick/studio/ua/externalpreview#gr8bWOl_S3KVZB9PcCSb7w/creativeId=24677336">this example unit.</a> It may look very simple, but it&#39;s more complex than it seems.</p>

<ol><li>The collapsed animation should fade to black <strong>before</strong> the expand starts. (<code>META_TRIGGERED</code> in conjunction with <code>_DELAY</code>)</li><li>The expanded swf starts from black and fades into view only <strong>after</strong> the expand animation&#39;s done.<br/>Furthermore, the YouTube player component initialization is likewise done after expansion to avoid freezing/jerking while expanding. (<code>META_EXPANDED</code>)</li><li>Expanded animation fades to black <strong>before</strong>* collapsing (same approach as #1)</li><li>YouTube player instance is destroyed (<code>instance.destroy()</code>) as part of garbage collection when collapse animation starts. (<code>META_COLLAPSING</code>)</li><li>Like with #2, the collapse SWF now starts from black and fades into view <strong>after</strong> the collapse is done - but with <code>META_COLLAPSED</code> this time.</li><li>You may or may not have noticed it, but the collapsed frame alternates between frame 1 and 2 on every collapse - this is triggered during <code>META_EXPANDED</code></li></ol>

<p>As you can see, only <code>META_EXPANDING</code> seems to be useless (but it&#39;s included just in case one may find a use for it). The rest have real practical value depending on what type of implementation you intend to do.</p>

<p>If you also would notice, if you have the <code>_DELAY</code> set and code &quot;collapse animations&quot; accordingly, the collapse will always do it <em>regardless</em> of what triggered it.</p>

<p>So leaving the unit while having <code>_MOUSECOLLAPSE</code>, or pressing the close button, or doing an exit event will always run through the animation sequence for a more graceful collapse.</p>

<h2>Bullet-proofing</h2>

<p>I&#39;ve also tried protecting the unit from unexpected calls as far as the core functionality (expand/collapse) goes.</p>

<p>For example, an expand/collapse is fired only once (for every transition) even if you click rapidly. In the recent sample unit, because of the 1-second <code>_DELAY</code>, you can actually click on the exit, close button, and move out the unit (though <code>_MOUSECOLLAPSE</code> isn&#39;t enabled.) before the collapse starts - imagine what mayhem this could cause to your actions in the <code>META</code> handler (as they&#39;d probably be called multiple times) - as well as the messy reporting to the Studio console.</p>

<p>Likewise, expand/collapse calls cannot be done <strong>during</strong> a [expand/collapse] transition. So if you click on the background exit, or mouseout (assuming you have <code>_MOUSECOLLAPSE</code> enabled) <strong>while</strong> the unit is expanding/collapsing, it will proceed with what it&#39;s doing. It essentially &quot;disables&quot; the unit during the transitions, to avoid buggy behavior.</p>
    </section>
    <section id="changelog"><h1>Changelog</h1>

<h2>1.0</h2>

<ul><li>Initial release</li></ul>
    </section>
    <script>
      $(document).ready(function() {
       $('pre.syntax').each(function(i, e) {hljs.highlightBlock(e)});
      });
    </script>
  </body>
</html>